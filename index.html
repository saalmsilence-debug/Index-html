<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Saalm Silence | Business Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Import Map for React and Firebase Modules -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
        }
    }
    </script>

    <!-- Babel for JSX compilation in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        
        /* Smooth transitions */
        .tab-content { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Mobile safe areas */
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        
        /* Hide scrollbar for clean UI */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="text-slate-800 h-screen overflow-hidden flex flex-col">

    <div id="root" class="h-full flex flex-col"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            BookOpen, CreditCard, TrendingUp, Users, Calendar, 
            LogOut, Plus, DollarSign, ArrowUpRight, ArrowDownLeft, 
            Trash2, CheckCircle, Briefcase, Wallet, PieChart, Menu, X 
        } from 'lucide-react';
        
        import { initializeApp } from 'firebase/app';
        import { 
            getAuth, signInAnonymously, signInWithCustomToken, 
            onAuthStateChanged, signOut 
        } from 'firebase/auth';
        import { 
            getFirestore, collection, addDoc, query, where, 
            onSnapshot, deleteDoc, doc, updateDoc, orderBy, serverTimestamp 
        } from 'firebase/firestore';

        // --- Firebase Init ---
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // --- 1. Auth Screen ---
        const AuthScreen = ({ onLogin }) => {
            const [isRegistering, setIsRegistering] = useState(false);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [businessName, setBusinessName] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = (e) => {
                e.preventDefault();
                setLoading(true);
                // Simulate network delay for UX
                setTimeout(() => {
                    onLogin({ email, businessName: businessName || 'My Business' });
                    setLoading(false);
                }, 800);
            };

            return (
                <div className="h-full w-full bg-gradient-to-br from-emerald-600 to-slate-900 flex items-center justify-center p-6">
                    <div className="bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden">
                        <div className="p-8 text-center bg-emerald-50/50 border-b border-emerald-100">
                            <div className="w-16 h-16 bg-emerald-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg rotate-3 hover:rotate-6 transition-transform">
                                <Briefcase className="text-white w-8 h-8" />
                            </div>
                            <h1 className="text-2xl font-bold text-slate-800">Saalm Silence</h1>
                            <p className="text-emerald-600 font-medium text-sm">Business Management Suite</p>
                        </div>
                        
                        <form onSubmit={handleSubmit} className="p-8 space-y-4">
                            {isRegistering && (
                                <input 
                                    required type="text" 
                                    className="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 outline-none transition bg-slate-50"
                                    placeholder="Business Name"
                                    value={businessName} onChange={(e) => setBusinessName(e.target.value)}
                                />
                            )}
                            <input 
                                required type="text" 
                                className="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 outline-none transition bg-slate-50"
                                placeholder="Email / ID"
                                value={email} onChange={(e) => setEmail(e.target.value)}
                            />
                            <input 
                                required type="password" 
                                className="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 outline-none transition bg-slate-50"
                                placeholder="Password"
                                value={password} onChange={(e) => setPassword(e.target.value)}
                            />

                            <button 
                                type="submit" disabled={loading}
                                className="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-emerald-200 active:scale-95 transition-all"
                            >
                                {loading ? 'Accessing...' : (isRegistering ? 'Register Business' : 'Secure Login')}
                            </button>

                            <button 
                                type="button"
                                onClick={() => setIsRegistering(!isRegistering)}
                                className="w-full text-center text-xs text-slate-400 hover:text-emerald-600 mt-4"
                            >
                                {isRegistering ? 'Back to Login' : 'Create New Business Account'}
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        // --- 2. Ledger Tab ---
        const Ledger = ({ userId }) => {
            const [transactions, setTransactions] = useState([]);
            const [type, setType] = useState('income');
            const [amount, setAmount] = useState('');
            const [desc, setDesc] = useState('');

            useEffect(() => {
                if (!userId) return;
                const q = query(collection(db, 'artifacts', appId, 'users', userId, 'transactions'), orderBy('createdAt', 'desc'));
                const unsub = onSnapshot(q, (s) => setTransactions(s.docs.map(d => ({id: d.id, ...d.data()}))));
                return () => unsub();
            }, [userId]);

            const handleAdd = async (e) => {
                e.preventDefault();
                if(!amount || !desc) return;
                await addDoc(collection(db, 'artifacts', appId, 'users', userId, 'transactions'), {
                    type, amount: parseFloat(amount), description: desc, createdAt: serverTimestamp(), date: new Date().toISOString()
                });
                setAmount(''); setDesc('');
            };

            const deleteItem = async (id) => {
                await deleteDoc(doc(db, 'artifacts', appId, 'users', userId, 'transactions', id));
            }

            return (
                <div className="tab-content h-full flex flex-col p-4 space-y-4">
                    <div className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                        <h2 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <BookOpen className="text-emerald-600 w-5 h-5" /> General Ledger
                        </h2>
                        <form onSubmit={handleAdd} className="flex flex-col gap-3">
                            <div className="flex gap-2">
                                <select value={type} onChange={e => setType(e.target.value)} className="bg-slate-50 border rounded-lg px-3 py-2 text-sm outline-none focus:ring-1 focus:ring-emerald-500">
                                    <option value="income">Income (+)</option>
                                    <option value="expense">Expense (-)</option>
                                </select>
                                <input type="number" placeholder="0.00" value={amount} onChange={e => setAmount(e.target.value)} className="flex-1 bg-slate-50 border rounded-lg px-3 py-2 text-sm outline-none focus:ring-1 focus:ring-emerald-500" />
                            </div>
                            <div className="flex gap-2">
                                <input type="text" placeholder="Description" value={desc} onChange={e => setDesc(e.target.value)} className="flex-1 bg-slate-50 border rounded-lg px-3 py-2 text-sm outline-none focus:ring-1 focus:ring-emerald-500" />
                                <button className="bg-emerald-600 text-white px-4 rounded-lg font-medium text-sm shadow hover:bg-emerald-700">Add</button>
                            </div>
                        </form>
                    </div>

                    <div className="flex-1 overflow-y-auto no-scrollbar pb-20">
                        <div className="space-y-2">
                            {transactions.map(t => (
                                <div key={t.id} className="bg-white p-3 rounded-xl border border-slate-100 shadow-sm flex justify-between items-center">
                                    <div>
                                        <div className="font-medium text-slate-800 text-sm">{t.description}</div>
                                        <div className="text-xs text-slate-400">{t.date ? t.date.split('T')[0] : 'Today'}</div>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <span className={`font-bold text-sm ${t.type === 'income' ? 'text-emerald-600' : 'text-rose-500'}`}>
                                            {t.type === 'income' ? '+' : '-'}${t.amount}
                                        </span>
                                        <button onClick={() => deleteItem(t.id)} className="text-slate-300 hover:text-rose-500"><Trash2 size={16} /></button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // --- 3. Journal Tab (Small Transactions) ---
        const Journal = ({ userId }) => {
            const [amount, setAmount] = useState('');
            const [note, setNote] = useState('');

            const quickAdd = async (type) => {
                if(!amount) return;
                await addDoc(collection(db, 'artifacts', appId, 'users', userId, 'transactions'), {
                    type, amount: parseFloat(amount), description: note || (type === 'income' ? 'Cash Sale' : 'Petty Cash'), category: 'Journal', createdAt: serverTimestamp(), date: new Date().toISOString()
                });
                setAmount(''); setNote('');
            };

            return (
                <div className="tab-content h-full flex flex-col items-center justify-center p-6 space-y-6">
                    <div className="bg-white p-8 rounded-3xl shadow-xl w-full max-w-sm text-center border border-slate-100">
                        <div className="mb-6 flex justify-center">
                            <div className="bg-emerald-100 p-3 rounded-full">
                                <CreditCard className="text-emerald-600 w-8 h-8" />
                            </div>
                        </div>
                        <h2 className="text-xl font-bold text-slate-800 mb-1">Quick Journal</h2>
                        <p className="text-slate-400 text-sm mb-6">Record small daily transactions</p>

                        <div className="bg-slate-50 p-4 rounded-2xl mb-6 border border-slate-100">
                            <div className="flex items-center justify-center text-4xl font-mono text-slate-700">
                                <span className="text-2xl mr-1 text-slate-400">$</span>
                                <input 
                                    type="number" value={amount} onChange={e => setAmount(e.target.value)} 
                                    className="bg-transparent w-32 text-center outline-none" placeholder="0"
                                />
                            </div>
                            <input 
                                type="text" value={note} onChange={e => setNote(e.target.value)}
                                className="w-full text-center mt-2 bg-transparent text-sm text-slate-500 outline-none border-b border-transparent focus:border-emerald-300"
                                placeholder="Add a note..."
                            />
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <button onClick={() => quickAdd('income')} className="py-4 bg-emerald-600 hover:bg-emerald-700 active:scale-95 transition-all text-white rounded-xl flex flex-col items-center justify-center gap-1 shadow-lg shadow-emerald-200">
                                <ArrowUpRight size={24} />
                                <span className="text-xs font-bold uppercase tracking-wider">Cash In</span>
                            </button>
                            <button onClick={() => quickAdd('expense')} className="py-4 bg-rose-500 hover:bg-rose-600 active:scale-95 transition-all text-white rounded-xl flex flex-col items-center justify-center gap-1 shadow-lg shadow-rose-200">
                                <ArrowDownLeft size={24} />
                                <span className="text-xs font-bold uppercase tracking-wider">Cash Out</span>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 4. P&L Tab ---
        const ProfitLoss = ({ userId }) => {
            const [stats, setStats] = useState({ inc: 0, exp: 0, net: 0 });
            useEffect(() => {
                if(!userId) return;
                const unsub = onSnapshot(query(collection(db, 'artifacts', appId, 'users', userId, 'transactions')), (s) => {
                    let i = 0, e = 0;
                    s.docs.forEach(d => d.data().type === 'income' ? i += d.data().amount : e += d.data().amount);
                    setStats({ inc: i, exp: e, net: i - e });
                });
                return () => unsub();
            }, [userId]);

            return (
                <div className="tab-content h-full p-6 space-y-6 overflow-y-auto">
                    <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                        <TrendingUp className="text-emerald-600" /> Profit & Loss
                    </h2>
                    
                    <div className="grid grid-cols-1 gap-4">
                        <div className="bg-white p-6 rounded-2xl shadow-sm border-l-4 border-emerald-500">
                            <div className="text-xs uppercase text-slate-400 font-bold tracking-wider mb-1">Total Revenue</div>
                            <div className="text-3xl font-bold text-emerald-600">${stats.inc.toFixed(2)}</div>
                        </div>
                        <div className="bg-white p-6 rounded-2xl shadow-sm border-l-4 border-rose-500">
                            <div className="text-xs uppercase text-slate-400 font-bold tracking-wider mb-1">Total Expenses</div>
                            <div className="text-3xl font-bold text-rose-600">${stats.exp.toFixed(2)}</div>
                        </div>
                        <div className={`bg-gradient-to-br p-6 rounded-2xl shadow-lg text-white ${stats.net >= 0 ? 'from-emerald-600 to-teal-700' : 'from-rose-600 to-orange-700'}`}>
                            <div className="text-xs uppercase text-white/70 font-bold tracking-wider mb-1">Net Profit</div>
                            <div className="text-4xl font-bold">${stats.net.toFixed(2)}</div>
                            <div className="mt-2 text-sm text-white/80">{stats.net >= 0 ? 'Profitable Status' : 'Loss Status'}</div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 5. Debt Manager ---
        const DebtManager = ({ userId }) => {
            const [debts, setDebts] = useState([]);
            const [form, setForm] = useState({ person: '', amount: '', type: 'in' });

            useEffect(() => {
                if(!userId) return;
                const unsub = onSnapshot(query(collection(db, 'artifacts', appId, 'users', userId, 'debts'), orderBy('createdAt', 'desc')), 
                    (s) => setDebts(s.docs.map(d => ({id:d.id, ...d.data()})))
                );
                return () => unsub();
            }, [userId]);

            const addDebt = async (e) => {
                e.preventDefault();
                if(!form.amount) return;
                await addDoc(collection(db, 'artifacts', appId, 'users', userId, 'debts'), { ...form, amount: parseFloat(form.amount), status: 'pending', createdAt: serverTimestamp() });
                setForm({ person: '', amount: '', type: 'in' });
            };

            const toggle = async (id, s) => {
                await updateDoc(doc(db, 'artifacts', appId, 'users', userId, 'debts', id), { status: s === 'paid' ? 'pending' : 'paid' });
            };

            return (
                <div className="tab-content h-full p-4 flex flex-col">
                    <div className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 mb-4">
                        <h2 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2"><Wallet className="text-emerald-600 w-5 h-5"/> Debt Manager</h2>
                        <div className="flex bg-slate-100 p-1 rounded-lg mb-3">
                            <button onClick={() => setForm({...form, type: 'in'})} className={`flex-1 py-1.5 text-xs font-bold rounded-md transition ${form.type === 'in' ? 'bg-white text-emerald-700 shadow' : 'text-slate-400'}`}>Debt IN (Collect)</button>
                            <button onClick={() => setForm({...form, type: 'out'})} className={`flex-1 py-1.