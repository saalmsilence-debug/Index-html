<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Book 7 - Working MVP</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial; background:#f1f1f1; margin:0; padding:10px; }
.screen { display:none; }
.screen.active { display:block; }
button { padding:10px; margin:8px 0; width:100%; background:#222; color:#fff; border:none; border-radius:5px; }
input, select { padding:10px; width:100%; margin:5px 0; }
.box { background:#fff; padding:12px; border-radius:10px; margin:10px 0; box-shadow:0 2px 6px rgba(0,0,0,.1); }
li { margin:5px 0; font-size:14px; }
/* Styles for visual distinction on the list */
.income { color: darkgreen; }
.expense { color: darkred; }
</style>
</head>

<body>

<div id="login" class="screen active">
  <h2>Book 7 Login</h2>
  <input id="user" placeholder="Business Name">
  <button onclick="login()">Enter Dashboard</button>
</div>

<div id="dashboard" class="screen">
  <h2 id="welcome"></h2>

  <div class="box">
    <h3>Add Record</h3>
    <input id="desc" placeholder="Description">
    <input id="amount" type="number" placeholder="Amount">
    <select id="type">
      <option value="income">Income</option>
      <option value="expense">Expense</option>
    </select>
    
    <p id="feedbackMessage" style="height: 1.2em; margin: 5px 0; font-size: 14px;"></p> 
    
    <button onclick="addRecord()">Save Record</button>
  </div>

  <div class="box">
    <h3>Current Balance</h3>
    <p id="balance">Ksh 0</p>
  </div>

  <div class="box">
    <h3>Transaction Records</h3>
    <ul id="list"></ul>
  </div>

  <button onclick="clearData()">Clear All Records</button>
  <button onclick="logout()">Logout</button>
</div>

<script>
// Load data from Local Storage on startup
let records = JSON.parse(localStorage.getItem("book7data")) || [];
let businessName = localStorage.getItem("book7user") || "";

window.onload = function(){
  if(businessName){
    showDashboard();
  }
}

function login(){
  let user = document.getElementById("user").value.trim();
  if(!user){ alert("Enter business name"); return; }
  localStorage.setItem("book7user", user);
  businessName = user;
  showDashboard();
}

function showDashboard(){
  document.getElementById("login").classList.remove("active");
  document.getElementById("dashboard").classList.add("active");
  document.getElementById("welcome").innerText = "Welcome to Book 7, " + businessName;
  render();
}

function addRecord(){
  let desc = document.getElementById("desc").value.trim();
  let amount = parseFloat(document.getElementById("amount").value);
  let type = document.getElementById("type").value;
  let feedback = document.getElementById("feedbackMessage"); 

  // --- INPUT VALIDATION: Check for Description, Number, and Positive Amount ---
  if (!desc) {
    feedback.innerText = "❌ Please enter a description.";
    feedback.style.color = 'red';
    return;
  }
  if (isNaN(amount) || amount <= 0) {
    feedback.innerText = "❌ Please enter a valid amount greater than 0.";
    feedback.style.color = 'red';
    return;
  }

  // Clear previous feedback on success path
  feedback.innerText = "";
  
  // Save record object
  records.push({desc, amount, type, date:new Date().toLocaleString()});
  localStorage.setItem("book7data", JSON.stringify(records));
  
  // Clear inputs
  document.getElementById("desc").value = "";
  document.getElementById("amount").value = "";
  
  // Render updates and show success feedback
  render();

  feedback.innerText = `✅ Success! Ksh ${amount} (${type.toUpperCase()}) recorded.`;
  feedback.style.color = 'green';
  
  // Clear the success message after 3 seconds
  setTimeout(() => { feedback.innerText = ""; }, 3000);
}

function render(){
  let list = document.getElementById("list");
  list.innerHTML = "";
  let balance = 0;

  records.forEach(r=>{
    let li = document.createElement("li");
    li.textContent = `${r.date} | ${r.desc} - ${r.type.toUpperCase()} : Ksh ${r.amount}`;
    
    // Add CSS class (income or expense) for visual distinction
    li.classList.add(r.type); 
    
    list.appendChild(li);
    // Calculate balance
    balance += (r.type === "income" ? r.amount : -r.amount);
  });

  document.getElementById("balance").innerText = "Ksh " + balance;
}

function logout(){
  localStorage.removeItem("book7user");
  location.reload();
}

function clearData(){
  if(confirm("Delete all records?")){
    records = [];
    localStorage.removeItem("book7data");
    render();
  }
}
</script>

</body>
</html>
